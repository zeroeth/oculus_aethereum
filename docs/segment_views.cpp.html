<!DOCTYPE html>

<html>
<head>
  <title>segment_views.cpp</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="oculus_aethereum.ino.html">
                oculus_aethereum.ino
              </a>
            
              
              <a class="source" href="segment_models.cpp.html">
                segment_models.cpp
              </a>
            
              
              <a class="source" href="segment_models.h.html">
                segment_models.h
              </a>
            
              
              <a class="source" href="segment_views.cpp.html">
                segment_views.cpp
              </a>
            
              
              <a class="source" href="segment_views.h.html">
                segment_views.h
              </a>
            
              
              <a class="source" href="themes.h.html">
                themes.h
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>segment_views.cpp</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="preprocessor">#include "segment_views.h"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>StripView Constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>StripView::StripView (Adafruit_NeoPixel&amp; n_strip, uint8_t n_starting_led, uint8_t n_length):
  strip (n_strip),
  starting_led (n_starting_led),
  length (n_length),
  spot_count (<span class="number">0</span>) <span class="comment">/* Initializer list */</span>
{
}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Add spot to list of spots for this view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">void</span> StripView::add (Spot *spot)
{
  spots[spot_count] = spot;
  spot_count++;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Update all spots</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">void</span> StripView::update ()
{
  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; spot_count; i++)
  {
    spots[i]-&gt;update ();
  }
}


<span class="keyword">void</span> StripView::draw ()
{
  <span class="comment">/* TODO figure out where strip view and spot view separate for drawing logic.. does spot view create the dots and colors and then strip over lays those pixels into its buffer (additive or whatever) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Draw every spot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> (uint8_t i = <span class="number">0</span>; i &lt; spot_count; i++)
  {
    spots[i]-&gt;update ();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>For width of the spot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> (uint8_t w = <span class="number">0</span>; w &lt; spots[i]-&gt;width; w++)
    {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Map position to strip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      uint8_t position = (<span class="keyword">int</span>(spots[i]-&gt;position * length) + w) - spots[i]-&gt;width/<span class="number">2</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Wrap around the segment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      draw_at ((position % length) + starting_led, spots[i]-&gt;color);
    }
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Clear strip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">void</span> StripView::clear ()
{
  <span class="keyword">for</span>(uint8_t i = starting_led; i &lt; (starting_led+length); i++)
  {
    uint32_t start_color = strip.getPixelColor (i);
    uint8_t r,g,b;

    r = (uint8_t)(start_color &gt;&gt; <span class="number">16</span>),
    g = (uint8_t)(start_color &gt;&gt;  <span class="number">8</span>),
    b = (uint8_t)(start_color &gt;&gt;  <span class="number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Dim brightness FIXME fails to gracefully fade dim colors (because it runs a lot per second)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    uint32_t color = strip.Color (r * <span class="number">0.9</span>, g * <span class="number">0.9</span>, b * <span class="number">0.9</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>strip.setPixelColor (i, color);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    strip.setPixelColor (i, strip.Color(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Draw a color into the strip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">void</span> StripView::draw_at (uint8_t position, uint32_t color)
{
  strip.setPixelColor (position, color);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Add color into the strip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">void</span> StripView::add_at (uint8_t position, uint32_t color)
{
  uint32_t added_colors = add_colors (color, strip.getPixelColor (position));
  strip.setPixelColor (position, added_colors);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Blend two colors together</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>uint32_t StripView::add_colors (uint32_t color1, uint32_t color2)
{
  uint8_t r1,g1,b1;
  uint8_t r2,g2,b2;
  uint8_t r3,g3,b3;

  r1 = (uint8_t)(color1 &gt;&gt; <span class="number">16</span>),
  g1 = (uint8_t)(color1 &gt;&gt;  <span class="number">8</span>),
  b1 = (uint8_t)(color1 &gt;&gt;  <span class="number">0</span>);

  r2 = (uint8_t)(color2 &gt;&gt; <span class="number">16</span>),
  g2 = (uint8_t)(color2 &gt;&gt;  <span class="number">8</span>),
  b2 = (uint8_t)(color2 &gt;&gt;  <span class="number">0</span>);


  <span class="keyword">return</span> strip.Color (constrain (r1+r2, <span class="number">0</span>, <span class="number">255</span>), constrain (g1+g2, <span class="number">0</span>, <span class="number">255</span>), constrain (b1+b2, <span class="number">0</span>, <span class="number">255</span>));
}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Prepare for a new theme</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">void</span> StripView::unload_theme ()
{
  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; spot_count; i++)
  {
    <span class="keyword">delete</span> spots[i];
  }
  spot_count = <span class="number">0</span>;
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
